# Stripe Payment Setup Guide

Это руководство поможет вам настроить платежную систему Stripe для вашего приложения.

## Шаг 1: Создание аккаунта Stripe

1. Перейдите на [stripe.com](https://stripe.com) и создайте аккаунт
2. Подтвердите ваш email и завершите настройку аккаунта

## Шаг 2: Получение API ключей

1. Войдите в [Stripe Dashboard](https://dashboard.stripe.com)
2. Перейдите в раздел **Developers** → **API keys**
3. Скопируйте следующие ключи:
   - **Publishable key** (начинается с `pk_test_`)
   - **Secret key** (начинается с `sk_test_`)

## Шаг 3: Настройка переменных окружения

Откройте файл `.env.local` и замените placeholder значения на ваши реальные ключи:

```env
# Stripe Payment
STRIPE_SECRET_KEY=sk_test_ваш_секретный_ключ_здесь
NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY=pk_test_ваш_публичный_ключ_здесь
STRIPE_WEBHOOK_SECRET=whsec_ваш_webhook_секрет_здесь
```

## Шаг 4: Настройка Webhook (для продакшена)

Для локальной разработки webhook не обязателен, но для продакшена:

1. В Stripe Dashboard перейдите в **Developers** → **Webhooks**
2. Нажмите **Add endpoint**
3. Введите URL: `https://ваш-домен.com/api/webhook/stripe`
4. Выберите события:
   - `checkout.session.completed`
   - `invoice.payment_succeeded`
   - `customer.subscription.updated`
   - `customer.subscription.deleted`
5. Скопируйте **Signing secret** и добавьте в `.env.local`

## Шаг 5: Тестирование

1. Запустите приложение: `npm run dev`
2. Перейдите на страницу `/pricing`
3. Выберите план и нажмите кнопку оплаты
4. Используйте тестовые карты Stripe:
   - **Успешная оплата**: `4242 4242 4242 4242`
   - **Отклоненная карта**: `4000 0000 0000 0002`
   - Любая будущая дата для срока действия
   - Любой 3-значный CVC

## Цены и планы

Текущие настройки:

### Подписка Pro

- **Цена**: $20/месяц
- **Функции**: Безлимитные генерации

### Покупка кредитов

- **100 кредитов**: $10
- **500 кредитов**: $40 (популярный)
- **1000 кредитов**: $70

## Структура файлов

```
app/
├── api/
│   ├── stripe/
│   │   ├── route.ts              # Создание подписки
│   │   ├── credits/route.ts      # Покупка кредитов
│   │   └── verify-payment/route.ts # Верификация платежа
│   └── webhook/
│       └── stripe/route.ts       # Обработка webhook'ов
├── payment/
│   ├── success/page.tsx          # Страница успешной оплаты
│   └── cancel/page.tsx           # Страница отмены оплаты
└── pricing/page.tsx              # Страница тарифов

components/
└── payment-modal.tsx             # Модальное окно оплаты
```

## Безопасность

⚠️ **Важно**:

- Никогда не коммитьте реальные API ключи в репозиторий
- Используйте тестовые ключи для разработки
- Переключитесь на продакшн ключи только при деплое

## Поддержка

Если у вас возникли проблемы:

1. Проверьте логи в консоли браузера
2. Проверьте логи сервера
3. Убедитесь, что все переменные окружения настроены правильно
4. Проверьте [документацию Stripe](https://stripe.com/docs)
